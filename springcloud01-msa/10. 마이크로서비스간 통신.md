# 마이크로서비스간 통신

### Communication Types

- Synchronous HTTP communication
- Asynchronous communication over AMQP
- Rest Template

# Rest Template을 이용해 마이크로서비스간 통신해보기

1. UserServiceApplication.java

```java
public class UserServiceApplication {
    ...
	@Bean
	@LoadBalanced
	public RestTemplate getRestTemplate(){
		return new RestTemplate();
	}
}

```

- @LoadBalanced: 아래 url 작성할 때, 마이크로서비스 이름으로 접근하기 위함

2. application.yml

```yml
order_service:
  url: http://order-service/order-service/%s/orders
```

3. UserController.java

```java
        String orderUrl = String.format(env.getProperty("order_service.url"), userId); // String.format: order_service.url에 들어있는 변수(%s)에 값을 넣기 위함
        /**
         * exchange() Desc
         * 매개변수1: 주소값
         * 매개변수2: HTTP Method
         * 매개변수3: 요청할 때 파라미터
         * 매개변수4: 전달받을 형식
         */
        ResponseEntity<List<ResponseOrder>> orderListResponse =
                restTemplate.exchange(orderUrl, HttpMethod.GET, null,
                        new ParameterizedTypeReference<List<ResponseOrder>>() {
        });
        List<ResponseOrder> ordersList = orderListResponse.getBody();
        userDto.setOrders(ordersList);
```

- url에 Eureka에 등록된 마이크로서비스 이름 / URI로 작성할 수 있다.(IP,Port로 하면 변경 시 불편)
